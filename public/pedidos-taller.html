<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mis Pedidos - Recambio Reciclado IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="/js/global.js"></script>
</head>
<body class="bg-slate-50 dark:bg-slate-950 min-h-screen transition-colors">

    <nav class="bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800 px-6 py-3 flex justify-between items-center sticky top-0 z-[100]">
        <div class="flex items-center gap-4">
            <img src="/assets/logo.png" alt="Logo" class="h-8 dark:brightness-0 dark:invert">
            <h1 class="text-slate-800 dark:text-white font-black text-sm uppercase tracking-tighter hidden sm:block">Recambio Reciclado IA</h1>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-xl text-slate-400 flex items-center justify-center">
                <i class="fas fa-moon dark:hidden"></i>
                <i class="fas fa-sun hidden dark:block text-yellow-500"></i>
            </button>
            <div class="relative group">
                <button class="w-10 h-10 bg-slate-50 dark:bg-slate-800 rounded-xl text-slate-600 dark:text-slate-300 flex items-center justify-center"><i class="fas fa-th-large"></i></button>
                <div class="absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 shadow-2xl rounded-3xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all p-4 border border-slate-100 dark:border-slate-700">
                    <a href="landing.html" class="block p-3 text-xs font-black uppercase text-slate-600 dark:text-slate-300">Menú Principal</a>
                </div>
            </div>
            <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-black text-xs">TA</div>
        </div>
    </nav>

    <header class="p-6 max-w-xl mx-auto flex justify-between items-center mt-4">
        <div>
            <h1 class="text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter">Mis Pedidos</h1>
            <p class="text-[10px] font-bold text-blue-500 uppercase tracking-widest" id="contador-piezas">Tablero Activo</p>
        </div>
        <button onclick="abrirModalNuevo()" class="w-14 h-14 bg-slate-900 dark:bg-blue-600 text-white rounded-2xl shadow-xl flex items-center justify-center">
            <i class="fas fa-plus text-xl"></i>
        </button>
    </header>

    <div class="flex bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800 sticky top-[65px] z-40">
        <button class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-blue-500 text-blue-600 dark:text-white">Activos</button>
        <button class="flex-1 py-4 text-[10px] font-black uppercase tracking-widest text-slate-400">Historial</button>
    </div>

    <main class="p-6 max-w-xl mx-auto space-y-4" id="listaPedidosTaller">
        <div class="bg-white dark:bg-slate-900 p-5 rounded-[30px] border border-slate-100 dark:border-slate-800 shadow-sm">
            <div class="flex justify-between items-start mb-3">
                <span class="text-[9px] font-black bg-green-100 text-green-600 px-3 py-1 rounded-full uppercase">Localizado</span>
                <span class="text-[9px] font-bold text-slate-400">#RR-4421</span>
            </div>
            <h3 class="text-sm font-black text-slate-800 dark:text-white uppercase">Faro Delantero Izq.</h3>
            <p class="text-[10px] text-slate-400 font-bold mt-1">Seat Leon (2020) - Full LED</p>
        </div>
    </main>

    <div id="modalPedido" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-center justify-center z-[200] p-6">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-[40px] p-8 shadow-2xl border dark:border-slate-800">
            <h2 class="text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter mb-2">Nuevo Recambio</h2>
            <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-6">La IA buscará disponibilidad inmediata</p>
            
            <form id="formPedido" onsubmit="procesarNuevoPedido(event)" class="space-y-4">
                <input type="text" id="nombrePieza" placeholder="¿Qué pieza buscas?" required class="w-full p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border-none text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="vehiculo" placeholder="Modelo y Año del coche" required class="w-full p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border-none text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-blue-500">
                
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="cerrarModal()" class="flex-1 py-4 text-slate-400 text-[10px] font-black uppercase">Cancelar</button>
                    <button type="submit" class="flex-1 py-4 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg shadow-blue-500/30">Pedir a la IA</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="mt-12 py-10 border-t border-slate-100 dark:border-slate-800 text-center">
        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
            Desarrollado por <span class="text-slate-900 dark:text-white font-black">Raul C.</span> | Versión Beta 1.2
        </p>
    </footer>

    <script>
        // Función para abrir el modal (Corrige el ReferenceError)
        function abrirModalNuevo() {
            const modal = document.getElementById('modalPedido');
            if(modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }

        // Función para cerrar el modal
        function cerrarModal() {
            const modal = document.getElementById('modalPedido');
            if(modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }

        // Función para procesar y añadir la tarjeta al Waffle
        function procesarNuevoPedido(event) {
            event.preventDefault();
            
            const pieza = document.getElementById('nombrePieza').value;
            const coche = document.getElementById('vehiculo').value;
            const lista = document.getElementById('listaPedidosTaller');

            // HTML de la nueva tarjeta con efecto "procesando"
            const nuevaTarjeta = `
                <div class="bg-white dark:bg-slate-900 p-5 rounded-[30px] border border-blue-200 dark:border-blue-900 shadow-md animate-pulse">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-[9px] font-black bg-blue-600 text-white px-3 py-1 rounded-full uppercase">Buscando...</span>
                        <span class="text-[9px] font-bold text-slate-400">#RR-TEMP</span>
                    </div>
                    <h3 class="text-sm font-black text-slate-800 dark:text-white uppercase">${pieza}</h3>
                    <p class="text-[10px] text-slate-400 font-bold mt-1">${coche}</p>
                </div>
            `;

            // Insertar arriba de la lista
            lista.insertAdjacentHTML('afterbegin', nuevaTarjeta);
            
            // Cerrar y limpiar
            cerrarModal();
            document.getElementById('formPedido').reset();
            
            // Actualizar contador visualmente
            document.getElementById('contador-piezas').innerText = "Solicitud enviada con éxito";
        }

        // Función necesaria para el cambio de modo oscuro
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        // Aplicar modo oscuro al cargar
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }
    </script>
</body>
</html>
