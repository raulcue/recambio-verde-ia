<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><title>Configuración de Usuarios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="/js/global.js"></script>
</head>
<body class="bg-slate-50">
    <div class="max-w-5xl mx-auto py-10 px-6">
        <h2 class="text-slate-800 font-black uppercase text-lg mb-6 tracking-tighter">Gestión de Accesos</h2>
        <div class="bg-white rounded-[2rem] shadow-sm border overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-50 text-[10px] font-black uppercase text-slate-400 border-b">
                    <tr><th class="p-5">Taller</th><th class="p-5">Email</th><th class="p-5">Rol</th><th class="p-5">Acción</th></tr>
                </thead>
                <tbody id="userBody"></tbody>
            </table>
        </div>
    </div>
    <script>
        async function loadUsers() {
            const res = await fetch('/api/usuarios');
            const users = await res.json();
            document.getElementById('userBody').innerHTML = users.map(u => `
                <tr class="border-b">
                    <td class="p-5 font-bold uppercase text-xs">${u.nombre_taller || 'ADMIN'}</td>
                    <td class="p-5 text-xs text-slate-500">${u.email}</td>
                    <td class="p-5">
                        <select onchange="updateRol(${u.id}, this.value)" class="text-[10px] font-black uppercase bg-slate-50 p-2 rounded-xl">
                            <option value="admin" ${u.rol==='admin'?'selected':''}>Admin</option>
                            <option value="gestor" ${u.rol==='gestor'?'selected':''}>Gestor</option>
                            <option value="taller" ${u.rol==='taller'?'selected':''}>Taller</option>
                        </select>
                    </td>
                    <td class="p-5"><button onclick="deleteUser(${u.id})" class="text-red-400 hover:scale-110 transition"><i class="fas fa-trash"></i></button></td>
                </tr>`).join('');
        }
        async function updateRol(id, rol) {
            await fetch(`/api/usuarios/${id}/rol`, { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({rol}) });
        }
        async function deleteUser(id) {
            if(confirm('¿Eliminar usuario?')) {
                await fetch(`/api/usuarios/${id}`, { method: 'DELETE' });
                loadUsers();
            }
        }
        loadUsers();
    </script>
</body>
</html>
