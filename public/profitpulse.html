<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ProfitPulse ¬∑ Revenue Intelligence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <script>
    tailwind.config = { darkMode: 'class' }
  </script>

  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 flex flex-col min-h-screen">

  <!-- HEADER din√°mico -->
  <div id="header-slot"></div>

  <!-- CONTENIDO -->
  <main class="flex-grow px-6 py-6 space-y-6 max-w-7xl mx-auto w-full">

    <!-- T√çTULO -->
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold tracking-tight flex items-center gap-2">
          üìà ProfitPulse
        </h1>
        <p class="text-xs text-slate-400 uppercase tracking-widest">
          Revenue Intelligence Engine
        </p>
      </div>
    </div>

    <!-- MODELO DE MONETIZACI√ìN -->
    <section class="bg-white dark:bg-slate-900 rounded-xl shadow p-6 space-y-4">
      <h2 class="font-semibold text-lg flex items-center gap-2">
        <i class="fa-solid fa-coins text-blue-500"></i>
        Modelo de Monetizaci√≥n
      </h2>

      <p class="text-sm text-slate-600 dark:text-slate-300">
        Cada pedido registrado en la tabla
        <code class="font-mono">pedidos</code> genera autom√°ticamente una comisi√≥n
        basada en el valor de coste de la pieza.
      </p>

      <ul class="text-sm space-y-2 text-slate-600 dark:text-slate-300 list-disc pl-5">
        <li>
          Comisi√≥n base: <strong>1% del precio de coste</strong>.
        </li>
        <li>
          Importe m√≠nimo por pedido:
          <strong>1,50 ‚Ç¨</strong> cuando el precio sea cero, nulo o no informado.
        </li>
        <li>
          Importe m√°ximo por pedido:
          <strong>3,50 ‚Ç¨</strong>.
        </li>
        <li>
          Moneda operativa: <strong>EUR</strong>.
        </li>
        <li>
          Pol√≠tica de redondeo: <strong>siempre al alza</strong>.
        </li>
      </ul>

      <p class="text-sm text-slate-600 dark:text-slate-300">
        Todos los c√°lculos est√°n alineados con la l√≥gica de negocio definida
        en <code class="font-mono">server.js</code> y referencian directamente
        los registros de la tabla <code class="font-mono">pedidos</code>.
      </p>
    </section>

    <!-- DISTRIBUCI√ìN DE COSTES -->
    <section class="bg-white dark:bg-slate-900 rounded-xl shadow p-6 space-y-4">
      <h2 class="font-semibold text-lg flex items-center gap-2">
        <i class="fa-solid fa-layer-group text-indigo-500"></i>
        Distribuci√≥n Interna de Costes
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Desarrollo</div>
          <div class="font-bold text-xl">60%</div>
          <div class="text-xs text-slate-500">
            Evoluci√≥n del producto, nuevas funcionalidades, optimizaci√≥n.
          </div>
        </div>

        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Mantenimiento</div>
          <div class="font-bold text-xl">20%</div>
          <div class="text-xs text-slate-500">
            Soporte operativo, incidencias, estabilidad.
          </div>
        </div>

        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Infraestructura</div>
          <div class="font-bold text-xl">20%</div>
          <div class="text-xs text-slate-500">
            Hosting, suscripciones, APIs, extensiones.
          </div>
        </div>
      </div>
    </section>

    <!-- PROYECCI√ìN ANUAL -->
    <section class="bg-white dark:bg-slate-900 rounded-xl shadow p-6 space-y-4">
      <h2 class="font-semibold text-lg flex items-center gap-2">
        <i class="fa-solid fa-chart-line text-emerald-500"></i>
        Proyecci√≥n Econ√≥mica Anual (Estimaci√≥n)
      </h2>

      <p class="text-sm text-slate-600 dark:text-slate-300">
        Las proyecciones se calculan extrapolando el volumen actual de pedidos
        registrados en la base de datos durante un per√≠odo anual.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Ingresos totales</div>
          <div class="font-bold text-xl">Proyecci√≥n din√°mica</div>
        </div>

        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Coste desarrollo</div>
          <div class="font-bold text-xl">‚âà 60%</div>
        </div>

        <div class="p-4 rounded-lg border dark:border-slate-700">
          <div class="text-xs uppercase text-slate-400">Coste plataforma</div>
          <div class="font-bold text-xl">‚âà 40%</div>
        </div>
      </div>
    </section>

    <!-- PIE DE ESTAD√çSTICAS -->
    <section class="bg-slate-100 dark:bg-slate-900/60 rounded-xl p-4 text-xs text-slate-500 flex flex-wrap gap-6 justify-between">
      <div>
        üì¶ Pedidos procesados: <strong id="stat-pedidos">‚Äî</strong>
      </div>
      <div>
        üí∂ Comisi√≥n media estimada: <strong>1,50 ‚Ç¨ ‚Äì 3,50 ‚Ç¨</strong>
      </div>
      <div>
        üóÉ Fuente de datos: tabla <code>pedidos</code>
      </div>
    </section>

  </main>

  <!-- FOOTER din√°mico -->
  <div id="footer-slot"></div>

  <!-- ================= SCRIPTS ================= -->
  <script>
    async function loadLayout() {
      const html = await fetch('/dashboard.html').then(r => r.text());
      const temp = document.createElement('div');
      temp.innerHTML = html;

      const header = temp.querySelector('header');
      const footer = temp.querySelector('footer');

      if (header) document.getElementById('header-slot').appendChild(header.cloneNode(true));
      if (footer) document.getElementById('footer-slot').appendChild(footer.cloneNode(true));
    }

    async function loadStats() {
      try {
        const res = await fetch('/api/pedidos');
        const pedidos = await res.json();
        document.getElementById('stat-pedidos').innerText = pedidos.length;
      } catch (e) {
        document.getElementById('stat-pedidos').innerText = 'N/A';
      }
    }

    loadLayout();
    loadStats();
  </script>

</body>
</html>
